######################################

# This script defines the project pipeline - it specifies the execution orders for all the code in this
# repo using a series of actions.

######################################


version: '3.0'

expectations:
  population_size: 10000

actions:

  generate_study_pop:
    run: cohortextractor:latest generate_cohort
     --study-definition study_definition_fourth
     --output-format=feather
    outputs:
      highly_sensitive:
        cohort: output/input_fourth.feather

  cumulative_fourth_dose:
   run: r:latest analysis/descriptive/cumulative_vax_byage.R
   needs: [generate_study_pop]
   outputs:
      moderately_sensitive:
        measure_csv: output/cumulative_rates/final_*.csv
        plot: output/cumulative_rates/plot_*.png

  covid_outcomes:
   run: r:latest analysis/descriptive/covid_outcomes_byage.R
   needs: [generate_study_pop]
   outputs:
      moderately_sensitive:
        measure_csv: output/covid_outcomes/covid_*.csv
        plot: output/covid_outcomes/plot_outcomes_*.png

  flu_vax:
   run: r:latest analysis/descriptive/flu_vax_byage.R
   needs: [generate_study_pop]
   outputs:
      moderately_sensitive:
        measure_csv: output/cumulative_rates/flu_*.csv
        plot: output/cumulative_rates/plot_flu_vax_byage.png
  
