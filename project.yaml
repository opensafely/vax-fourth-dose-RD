######################################

# This script defines the project pipeline - it specifies the execution orders for all the code in this
# repo using a series of actions.

######################################


version: '3.0'

expectations:
  population_size: 1000000

actions:

# Generating study population #
  generate_study_pop:
    run: cohortextractor:latest generate_cohort
      --study-definition study_definition_fourth
      --index-date-range "2022-09-02" 
      --output-dir=feather 
      --output-format=feather
    outputs:
      highly_sensitive:
        cohort: output/input_fourth*.feather

# Data processing




# Cumulative uptake of fourth dose #
  cumulative_fourth_dose:
   run: r:latest analysis/descriptive/cumulative_vax_byage.R
   needs: [generate_study_pop]
   outputs:
      moderately_sensitive:
        measure_csv: output/cumulative_rates/final_*.csv
        plot: output/cumulative_rates/plot_*.png

# Flu vaccine uptake #
  # flu_vax:
  #  run: r:latest analysis/descriptive/flu_vax_byage.R
  #  needs: [generate_study_pop]
  #  outputs:
  #     moderately_sensitive:
  #       measure_csv: output/cumulative_rates/flu_*.csv
  #       plot: output/cumulative_rates/plot_flu_vax_byage.png

# Discontinuity of demographics
  # demographics:
  #  run: r:latest analysis/descriptive/demographics_byage.R
  #  needs: [generate_study_pop]
  #  outputs:
  #     moderately_sensitive:
  #       measure_csv: output/variables_by_age/demographics_*.csv
  #       plot: output/variables_by_age/plot_*.png

# Outcome plots #
  # covid_outcomes:
  #  run: r:latest analysis/descriptive/covid_outcomes_byage.R
  #  needs: [generate_study_pop]
  #  outputs:
  #     moderately_sensitive:
  #       measure_csv: output/covid_outcomes/covid_*.csv
  #       plot: output/covid_outcomes/plot_outcomes_*.png
  

# ITT analysis #


# IV analysis #



  
